services:
  mongo-rag:
    image: mongo:7
    container_name: mongo-rag
    networks:
      - vector-rag-network
    volumes:
      - mongo_rag_db:/data/db
      - mongo_rag_config:/data/configdb

  redis-rag:
    image: redis:7-alpine
    container_name: redis-rag
    networks:
      - vector-rag-network

  qdrant-rag:
    image: qdrant/qdrant
    container_name: qdrant-rag
    ports:
      - "6333:6333"
    volumes:
      - ./qdrant_data:/qdrant/storage
    networks:
      - vector-rag-network

  app:
    build: .
    container_name: vector-rag-app
    ports:
      - "3002:3000"
    env_file:
      - .env
    environment:
      PORT: 3000
      DB_URL: ${DB_URL:-mongodb://mongo-rag:27017/vector-db-rag}
      QDRANT_URL: http://qdrant-rag:6333
      REDIS_URL: redis://redis-rag:6379

      # âœ… vector-rag -> ford-mailer
      CAMPAIGN_SERVICE_URL: ${CAMPAIGN_SERVICE_URL:-http://api:3000}

    volumes:
      - ./uploads:/app/uploads
    depends_on:
      - mongo-rag
      - redis-rag
      - qdrant-rag
    networks:
      - vector-rag-network
      - ford-mailer_default   # âœ… red externa, para resolver "api"
 

networks:
  vector-rag-network:
    name: vector-rag-network
    external: true

  ford-mailer_default:
    external: true
    name: ford-mailer_ford-mailer_default   # ðŸ‘ˆ ESTE es el nombre REAL que te mostrÃ³ `docker network ls`

volumes:
  mongo_rag_db:
  mongo_rag_config:
